<!DOCTYPE html><html dir="rtl"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous"/><link rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/9ddc91bf10736b63.css" as="style"/><link rel="stylesheet" href="/_next/static/css/9ddc91bf10736b63.css" data-n-g=""/><link rel="preload" href="/_next/static/css/57fa2be5d6c0cdd1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/57fa2be5d6c0cdd1.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee7e63bc15b31913.js" defer=""></script><script src="/_next/static/chunks/framework-114634acb84f8baa.js" defer=""></script><script src="/_next/static/chunks/main-673a4fae4a27af6a.js" defer=""></script><script src="/_next/static/chunks/pages/_app-78a051c38553426e.js" defer=""></script><script src="/_next/static/chunks/321-e6cc1b00c4d45973.js" defer=""></script><script src="/_next/static/chunks/9-91ee39ab5b55f745.js" defer=""></script><script src="/_next/static/chunks/281-4d6c20d89395e092.js" defer=""></script><script src="/_next/static/chunks/pages/note/%5Btitle%5D-9726dd10b352e051.js" defer=""></script><script src="/_next/static/vGVRqrlRXpVeIdz16Nji8/_buildManifest.js" defer=""></script><script src="/_next/static/vGVRqrlRXpVeIdz16Nji8/_ssgManifest.js" defer=""></script><style id="__jsx-9816238a097d8b2c">li.jsx-9816238a097d8b2c{display:-webkit-inline-box;display:-webkit-inline-flex;display:-moz-inline-box;display:-ms-inline-flexbox;display:inline-flex}</style><style id="__jsx-252829177">.cardHeader.jsx-252829177{background:url(/_next/static/media/header.8d53fe0d.png)#bf5140;height:120px;text-align:center;-webkit-border-radius:15px 15px 0 0;-moz-border-radius:15px 15px 0 0;border-radius:15px 15px 0 0;background-position:center;-webkit-background-size:600px;-moz-background-size:600px;-o-background-size:600px;background-size:600px;margin-bottom:40px}</style></head><body><div id="__next"><div class="jsx-9816238a097d8b2c navbar_navbar__jP4A8"><div class="nav container"><ul class="jsx-9816238a097d8b2c"><li class="jsx-9816238a097d8b2c"> <a class="navbar_navLink__lrkv8" href="/">صفحه ی اصلی</a> </li><li class="jsx-9816238a097d8b2c"> <a class="navbar_navLink__lrkv8" href="/category">دسته بندی ها</a> </li><li class="jsx-9816238a097d8b2c"> <a class="navbar_navLink__lrkv8" href="/note/%D9%85%D8%AB%D8%A7%D9%84_%D9%85%D8%B9%D9%85%D8%A7%D8%B1%DB%8C_%D9%85%DB%8C%DA%A9%D8%B1%D9%88%D8%B3%D8%B1%D9%88%DB%8C%D8%B3#">درباره ما</a> </li></ul></div></div><div class="container"><div class="row"><div class="col-md-8"><div class="jsx-252829177 note_card__oGU9m note_meduimFont__yRcxR around margin"><div class="jsx-252829177 note_title__npIjl"><h1 class="jsx-252829177">مثال معماری میکروسرویس</h1><p class="jsx-252829177">۱۴۰۱/۱۱/۲۷</p></div><div class="photo_cardContainer__WllSo"><div class="photo_card__rdmx2"><img class="photo_cardImgSolid__Cdop8" src="/images/5aaf5bf8e189a7ada150969d2f64d126.jpeg"/></div></div><div style="margin:20px"><p>معماری میکروسرویس تعریف های زیادی داره که یکیش تقسیم یک برنامه بزرگ به چند برنامه هماهنگ با هم و یکپارچه هست. نمونه کدی رو نوشتم که میتونه یک مثال خوب برای این تعریف باشه.</p></div><h3 id="سناریو" style="margin:10px">سناریو</h3><div style="margin:20px"><p>کاری که این سیستم انجام میده اینه که یک سری محصول یا product رو میگیره ، ذخیره میکنه و موجودی خودشو نشون میده.</p><p>به ساده ترین شکل ممکن نوشته شده و از اضافه کردن role و احراز هویت و این صحبت ها هم به دلیل حفظ سادگی و تسریع زمان صرف نظر شده.</p><p>نمونه کدی که نوشتم تحت فریم ورک nestjs ایجاد شده. یعنی از حالت های کلاسیک و عادی فاصله داره و ساختار مربوط به خودشو داره. تو این کد سعی کردم بیشتر معماری میکروسرویس رو براساس ساختار nestjs توضیح بدم.</p></div><h3 id="توضیح ساختار" style="margin:10px">توضیح ساختار</h3><div style="margin:20px"><p>برای درک این مثال ، نیاز هست که شما با نرم افزار Kafka و فریم ورک nestjs آشنایی داشته باشید.</p><p>توی این مثال هم از redis هم استفاده شده که اگر آشنایی ندارید میشه از داخل همین مثال هم متوجه اون شد.</p><p>برای پایگاه داده های این مثال هم از mongodb استفاده شده.</p><p>بستر اجرای مثال هم با docker پیاده سازی شده که کار کردن با اون به هیچ وجه سخت نیست. هرچند میشه بدون docker هم این مثال رو اجرا کرد اما استفاده از docker خیلی مهم شده و تقریبا اکثر نرم افزار ها برای پیشتیبانی و مدیریت بهتر منابع سرور ها با docker اجرا میشن.</p></div><div class="photo_cardContainer__WllSo"><div class="photo_card__rdmx2"><img class="photo_cardImgSolid__Cdop8" src="/images/440f5fc4c0a1188e24b7eb9eb0d4d8bf.png"/></div></div><div style="margin:20px"><p>میکروسرویس های این سیستم با استفاده از فریمورک nestjs ساخته شده. این میکروسرویس ها هرکدوم عهده دار یک ویژگی هستن. هرکدوم ازین میکروسرویس ها رو جداگانه معرفی میکنم و توضیح میدم.</p></div><h3 id="Rest Api Gate (دریافت کننده اصلی)" style="margin:10px">Rest Api Gate (دریافت کننده اصلی)</h3><div style="margin:20px"><p>البته از دیدگاه فریمورک nestjs یک nest server application بحساب میاد. کار این قسمت که حالا میکروسرویس باشه یا نباشه اینه که داده دریافت میکنه و به اقتضای نوع داده و محل دریافت داده اونو برای میکروسرویس مربوط ارسال میکنه.</p><p>هر میکروسرویس توی این دریافت کننده اصطلاحا نمایندگی داره. ینی توی کنترلر اصلی ، جایی که سرور پیام دریافت میکنه فوری برای میکروسرویس مربوط بهش ارسال میشه و جواب هم بدون هیچ تغییر از سمت سرور برگردونده میشه.</p><p>البته ممکنه احراز هویتی اگر بخاد وجود داشته باشه توی همین قسمت اتفاق میوفته ، اما ، اعتبارسنجی داده های ورودی که توی همین مثال هست هم توی سرور انجام میشه که اطمینان باشه که سرور داره داده درست و معتبر به میکروسرویس میفرسته.</p></div><h3 id="Writer Service (سرویس نویسنده)" style="margin:10px">Writer Service (سرویس نویسنده)</h3><div style="margin:20px"><p>کار این سرویس فقط همینه که داده ای که سرور دریافت کرده و براش فرستاده رو توی پایگاه داده ی مشترک ذخیره کنه. این داده هم توی پایگاه داده ذخیره میشه و هم به صورت خلاصه توی redis ذخیره میشه. </p><p>دلیل اینکه چرا از redis استفاده میشه هم اینه که redis داده رو روی ram ذخیره میکنه و سرعت بیشتری در خوندن و نوشتن داده ها ، نسبت به هارد دیسک ها و ssd داره.</p></div><h3 id="Reader Service (سرویس خواننده)" style="margin:10px">Reader Service (سرویس خواننده)</h3><div style="margin:20px"><p>این سرویس هم نقش خوندن داده ها رو برعهده داره ینی جایی که مثلا کاربرها میخان محصولات رو ببینن و میان و سرور rest برای این میکروسرویس درخواست میفرسته که مثلا همه یا یکی از محصولات رو نشون بده و سرویس هم از روی redis این کار رو انجام میده که سرعت بیشتری پیدا کنه.</p></div><h3 id="سایر اجزاء" style="margin:10px">سایر اجزاء</h3><div style="margin:20px"><p>بین این سرویس ها و سرور rest که توسط برنامه نویسی ساخته شده <i>(خودمو میگم)</i> ، این سیستم از یه سری از اجزای دیگه هم استفاده کرده. که اگر قسمت های بالا تر رو خونده باشید از kafka برای پیام رسانی بین سرویس ها ، از redis برای ذخیره سازی داده های پر استفاده و کم حجم و از mongodb هم به عنوان پایگاه داده های کلی سیستم استفاده شده.</p><p>استفاده از اون هم به صورت یک image هست که داخل docker hub قرار داره. به وسیله ابزار docker compose که بسیار جالب و کاربردی هم هست. تمام دستوراتی که شما توی shell باید بزنید رو به صورت مرتب و معنا دار و منظم تر داخل یک فایل با فرمت yml میارید و خود compose اقدام به اعمال اون روی engine داکر میکنه و کار ها رو بسیار سریع تر میکنه.</p></div><h3 id="خلاصه" style="margin:10px">خلاصه</h3><div style="margin:20px"><p>این یک مثال هست که بشدت ساده هست اما بخاطر معماری میکروسرویس توسعه پذیری بالایی پیدا کرده ینی همین کدهای مثال و ساده رو میشه به راحتی توسعه داد و به سمت یک سیستم معنا دار هدایت کرد.</p><p>از یه طرف وجود داکر هم توی این قصه بی تاثیر نیست چون میشه منابع رو کنترل کرد سرویس ها رو با ترتیب و نظم ایجاد و مدیریت کرد و توی مساله performance بسیاری از مشکلات رو  برطرف کرد.</p></div></div></div><div class="col-md-4"><div class="category_card___5fn2"><div style="background-position:center;background:url(/_next/static/media/header.8d53fe0d.png) #bf5140;background-size:600px;height:125px;text-align:center;border-radius:15px 15px 0 0;margin-bottom:30px"><img class="category_image__80jhs" src="/images/772ff88683178263e5a82c4cd95140a0.png"/></div><div class="category_card_content__puyqm around center"><h4>پروژه ها و سورس کد</h4><p>توضیح درباره کد هایی که قبلا ایجاد کرده ام.</p><ul><li><a class="link" href="/note/%D9%85%D8%AB%D8%A7%D9%84_%D9%85%D8%B9%D9%85%D8%A7%D8%B1%DB%8C_%D9%85%DB%8C%DA%A9%D8%B1%D9%88%D8%B3%D8%B1%D9%88%DB%8C%D8%B3">مثال معماری میکروسرویس</a></li></ul></div></div><div class="jsx-252829177 sticky-top"><div class="jsx-252829177 note_card__oGU9m note_card_links__0rN6I around"><h4 class="jsx-252829177 around center">مثال معماری میکروسرویس</h4><ul class="jsx-252829177"><li class="jsx-252829177"><a class="note_link__N_Jxr" href="/note/%D9%85%D8%AB%D8%A7%D9%84_%D9%85%D8%B9%D9%85%D8%A7%D8%B1%DB%8C_%D9%85%DB%8C%DA%A9%D8%B1%D9%88%D8%B3%D8%B1%D9%88%DB%8C%D8%B3#%D8%B3%D9%86%D8%A7%D8%B1%DB%8C%D9%88"> <!-- -->سناریو<!-- --> </a></li><li class="jsx-252829177"><a class="note_link__N_Jxr" href="/note/%D9%85%D8%AB%D8%A7%D9%84_%D9%85%D8%B9%D9%85%D8%A7%D8%B1%DB%8C_%D9%85%DB%8C%DA%A9%D8%B1%D9%88%D8%B3%D8%B1%D9%88%DB%8C%D8%B3#%D8%AA%D9%88%D8%B6%DB%8C%D8%AD%20%D8%B3%D8%A7%D8%AE%D8%AA%D8%A7%D8%B1"> <!-- -->توضیح ساختار<!-- --> </a></li><li class="jsx-252829177"><a class="note_link__N_Jxr" href="/note/%D9%85%D8%AB%D8%A7%D9%84_%D9%85%D8%B9%D9%85%D8%A7%D8%B1%DB%8C_%D9%85%DB%8C%DA%A9%D8%B1%D9%88%D8%B3%D8%B1%D9%88%DB%8C%D8%B3#Rest%20Api%20Gate%20(%D8%AF%D8%B1%DB%8C%D8%A7%D9%81%D8%AA%20%DA%A9%D9%86%D9%86%D8%AF%D9%87%20%D8%A7%D8%B5%D9%84%DB%8C)"> <!-- -->Rest Api Gate (دریافت کننده اصلی)<!-- --> </a></li><li class="jsx-252829177"><a class="note_link__N_Jxr" href="/note/%D9%85%D8%AB%D8%A7%D9%84_%D9%85%D8%B9%D9%85%D8%A7%D8%B1%DB%8C_%D9%85%DB%8C%DA%A9%D8%B1%D9%88%D8%B3%D8%B1%D9%88%DB%8C%D8%B3#Writer%20Service%20(%D8%B3%D8%B1%D9%88%DB%8C%D8%B3%20%D9%86%D9%88%DB%8C%D8%B3%D9%86%D8%AF%D9%87)"> <!-- -->Writer Service (سرویس نویسنده)<!-- --> </a></li><li class="jsx-252829177"><a class="note_link__N_Jxr" href="/note/%D9%85%D8%AB%D8%A7%D9%84_%D9%85%D8%B9%D9%85%D8%A7%D8%B1%DB%8C_%D9%85%DB%8C%DA%A9%D8%B1%D9%88%D8%B3%D8%B1%D9%88%DB%8C%D8%B3#Reader%20Service%20(%D8%B3%D8%B1%D9%88%DB%8C%D8%B3%20%D8%AE%D9%88%D8%A7%D9%86%D9%86%D8%AF%D9%87)"> <!-- -->Reader Service (سرویس خواننده)<!-- --> </a></li><li class="jsx-252829177"><a class="note_link__N_Jxr" href="/note/%D9%85%D8%AB%D8%A7%D9%84_%D9%85%D8%B9%D9%85%D8%A7%D8%B1%DB%8C_%D9%85%DB%8C%DA%A9%D8%B1%D9%88%D8%B3%D8%B1%D9%88%DB%8C%D8%B3#%D8%B3%D8%A7%DB%8C%D8%B1%20%D8%A7%D8%AC%D8%B2%D8%A7%D8%A1"> <!-- -->سایر اجزاء<!-- --> </a></li><li class="jsx-252829177"><a class="note_link__N_Jxr" href="/note/%D9%85%D8%AB%D8%A7%D9%84_%D9%85%D8%B9%D9%85%D8%A7%D8%B1%DB%8C_%D9%85%DB%8C%DA%A9%D8%B1%D9%88%D8%B3%D8%B1%D9%88%DB%8C%D8%B3#%D8%AE%D9%84%D8%A7%D8%B5%D9%87"> <!-- -->خلاصه<!-- --> </a></li></ul></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"c128f303-0d0c-4034-96d9-e57dac903a6f","title":"مثال معماری میکروسرویس","content":[{"richtext":[],"url":"http://localhost:31375/photo/5aaf5bf8e189a7ada150969d2f64d126.jpeg","id":"1bd8268c","type":"photo"},{"richtext":[{"content":[{"text":"معماری میکروسرویس تعریف های زیادی داره که یکیش تقسیم یک برنامه بزرگ به چند برنامه هماهنگ با هم و یکپارچه هست. نمونه کدی رو نوشتم که میتونه یک مثال خوب برای این تعریف باشه.","style":{"weight":[]}}]}],"id":"ac7382c5","type":"caption"},{"header":"h3","text":"سناریو","id":"f5c6b432","type":"title"},{"richtext":[{"content":[{"text":"کاری که این سیستم انجام میده اینه که یک سری محصول یا product رو میگیره ، ذخیره میکنه و موجودی خودشو نشون میده.","style":{"weight":[]}}]},{"content":[{"text":"به ساده ترین شکل ممکن نوشته شده و از اضافه کردن role و احراز هویت و این صحبت ها هم به دلیل حفظ سادگی و تسریع زمان صرف نظر شده.","style":{"weight":[]}}]},{"content":[{"text":"نمونه کدی که نوشتم تحت فریم ورک nestjs ایجاد شده. یعنی از حالت های کلاسیک و عادی فاصله داره و ساختار مربوط به خودشو داره. تو این کد سعی کردم بیشتر معماری میکروسرویس رو براساس ساختار nestjs توضیح بدم.","style":{"weight":[]}}]}],"id":"a12b805f","type":"caption"},{"header":"h3","text":"توضیح ساختار","id":"d54d60bc","type":"title"},{"richtext":[{"content":[{"text":"برای درک این مثال ، نیاز هست که شما با نرم افزار Kafka و فریم ورک nestjs آشنایی داشته باشید.","style":{"weight":[]}}]},{"content":[{"text":"توی این مثال هم از redis هم استفاده شده که اگر آشنایی ندارید میشه از داخل همین مثال هم متوجه اون شد.","style":{"weight":[]}}]},{"content":[{"text":"برای پایگاه داده های این مثال هم از mongodb استفاده شده.","style":{"weight":[]}}]},{"content":[{"text":"بستر اجرای مثال هم با docker پیاده سازی شده که کار کردن با اون به هیچ وجه سخت نیست. هرچند میشه بدون docker هم این مثال رو اجرا کرد اما استفاده از docker خیلی مهم شده و تقریبا اکثر نرم افزار ها برای پیشتیبانی و مدیریت بهتر منابع سرور ها با docker اجرا میشن.","style":{"weight":[]}}]}],"id":"d6f28ec1","type":"caption"},{"richtext":[],"url":"http://localhost:31375/photo/440f5fc4c0a1188e24b7eb9eb0d4d8bf.png","id":"10df0b94","type":"photo"},{"richtext":[{"content":[{"text":"میکروسرویس های این سیستم با استفاده از فریمورک nestjs ساخته شده. این میکروسرویس ها هرکدوم عهده دار یک ویژگی هستن. هرکدوم ازین میکروسرویس ها رو جداگانه معرفی میکنم و توضیح میدم.","style":{"weight":[]}}]}],"id":"8236a40e","type":"caption"},{"header":"h3","text":"Rest Api Gate (دریافت کننده اصلی)","id":"cc3d6e9c","type":"title"},{"richtext":[{"content":[{"text":"البته از دیدگاه فریمورک nestjs یک nest server application بحساب میاد. کار این قسمت که حالا میکروسرویس باشه یا نباشه اینه که داده دریافت میکنه و به اقتضای نوع داده و محل دریافت داده اونو برای میکروسرویس مربوط ارسال میکنه.","style":{"weight":[]}}]},{"content":[{"text":"هر میکروسرویس توی این دریافت کننده اصطلاحا نمایندگی داره. ینی توی کنترلر اصلی ، جایی که سرور پیام دریافت میکنه فوری برای میکروسرویس مربوط بهش ارسال میشه و جواب هم بدون هیچ تغییر از سمت سرور برگردونده میشه.","style":{"weight":[]}}]},{"content":[{"text":"البته ممکنه احراز هویتی اگر بخاد وجود داشته باشه توی همین قسمت اتفاق میوفته ، اما ، اعتبارسنجی داده های ورودی که توی همین مثال هست هم توی سرور انجام میشه که اطمینان باشه که سرور داره داده درست و معتبر به میکروسرویس میفرسته.","style":{"weight":[]}}]}],"id":"2b55c6a7","type":"caption"},{"header":"h3","text":"Writer Service (سرویس نویسنده)","id":"7ebf75af","type":"title"},{"richtext":[{"content":[{"text":"کار این سرویس فقط همینه که داده ای که سرور دریافت کرده و براش فرستاده رو توی پایگاه داده ی مشترک ذخیره کنه. این داده هم توی پایگاه داده ذخیره میشه و هم به صورت خلاصه توی redis ذخیره میشه. ","style":{"weight":[]}}]},{"content":[{"text":"دلیل اینکه چرا از redis استفاده میشه هم اینه که redis داده رو روی ram ذخیره میکنه و سرعت بیشتری در خوندن و نوشتن داده ها ، نسبت به هارد دیسک ها و ssd داره.","style":{"weight":[]}}]}],"id":"69739973","type":"caption"},{"header":"h3","text":"Reader Service (سرویس خواننده)","id":"53861e10","type":"title"},{"richtext":[{"content":[{"text":"این سرویس هم نقش خوندن داده ها رو برعهده داره ینی جایی که مثلا کاربرها میخان محصولات رو ببینن و میان و سرور rest برای این میکروسرویس درخواست میفرسته که مثلا همه یا یکی از محصولات رو نشون بده و سرویس هم از روی redis این کار رو انجام میده که سرعت بیشتری پیدا کنه.","style":{"weight":[]}}]}],"id":"807540fb","type":"caption"},{"header":"h3","text":"سایر اجزاء","id":"042e5ac3","type":"title"},{"richtext":[{"content":[{"text":"بین این سرویس ها و سرور rest که توسط برنامه نویسی ساخته شده ","style":{"weight":[]}},{"text":"(خودمو میگم)","style":{"weight":["ITALIC"]}},{"text":" ، این سیستم از یه سری از اجزای دیگه هم استفاده کرده. که اگر قسمت های بالا تر رو خونده باشید از kafka برای پیام رسانی بین سرویس ها ، از redis برای ذخیره سازی داده های پر استفاده و کم حجم و از mongodb هم به عنوان پایگاه داده های کلی سیستم استفاده شده.","style":{"weight":[]}}]},{"content":[{"text":"استفاده از اون هم به صورت یک image هست که داخل docker hub قرار داره. به وسیله ابزار docker compose که بسیار جالب و کاربردی هم هست. تمام دستوراتی که شما توی shell باید بزنید رو به صورت مرتب و معنا دار و منظم تر داخل یک فایل با فرمت yml میارید و خود compose اقدام به اعمال اون روی engine داکر میکنه و کار ها رو بسیار سریع تر میکنه.","style":{"weight":[]}}]}],"id":"7c851983","type":"caption"},{"header":"h3","text":"خلاصه","id":"5dc283ac","type":"title"},{"richtext":[{"content":[{"text":"این یک مثال هست که بشدت ساده هست اما بخاطر معماری میکروسرویس توسعه پذیری بالایی پیدا کرده ینی همین کدهای مثال و ساده رو میشه به راحتی توسعه داد و به سمت یک سیستم معنا دار هدایت کرد.","style":{"weight":[]}}]},{"content":[{"text":"از یه طرف وجود داکر هم توی این قصه بی تاثیر نیست چون میشه منابع رو کنترل کرد سرویس ها رو با ترتیب و نظم ایجاد و مدیریت کرد و توی مساله performance بسیاری از مشکلات رو  برطرف کرد.","style":{"weight":[]}}]}],"id":"af6caa42","type":"caption"}],"author":1,"createAt":"1676540288257","tag":[],"category":{"id":"bf44873b-0bd3-457c-8ed4-14504b877475","label":"پروژه ها و سورس کد","admin":1,"description":"توضیح درباره کد هایی که قبلا ایجاد کرده ام.","avatar":"772ff88683178263e5a82c4cd95140a0.png","color":"#bf5140","notes":[{"id":"c128f303-0d0c-4034-96d9-e57dac903a6f","title":"مثال معماری میکروسرویس","author":1,"createAt":"1676540288257","tag":[],"category":"bf44873b-0bd3-457c-8ed4-14504b877475"}]}}},"__N_SSG":true},"page":"/note/[title]","query":{"title":"مثال_معماری_میکروسرویس"},"buildId":"vGVRqrlRXpVeIdz16Nji8","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>