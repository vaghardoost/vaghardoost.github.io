{"pageProps":{"note":{"id":"40c76407215f9cb8","title":"متن بسته nodejs","content":[{"richtext":[{"content":[{"text":"این درسته که بخاطر open source شدن نرم افزار ها توسعه ی اون شدت زیادی گرفت. ولی هنوز بستن کد منبع رواج داره و تمام دلیلش بحث های امنیتی و سو استفاده هاست.","style":{"weight":[]}}]}],"id":"48e15034","type":"caption"},{"header":"h3","text":"پیشگفتار","id":"91814add","type":"title"},{"richtext":[{"content":[{"text":"گاها پروژه ای رو باید تحویل بدید که کد منبع اون غیرقابل خوندن باید باشه. برای مثال ازین بابت که ممکنه کد شما حفره هایی داشته باشه یا ساختار طوری باشه که بعضی خرابکار ها بیان و کد شما رو مطالعه کنن ، شما برای انتشار یک کد منبع بسته رو تحویل میدید که اجرا میشه ولی کد اون قابل خوندن نیست.","style":{"weight":[]}}]}],"id":"7c1051fe","type":"caption"},{"header":"h3","text":"webpack","id":"9cef8087","type":"title"},{"richtext":[],"url":"http://localhost:31375/photo/374a57fc6473fca89de6f550f9621adc.jpeg","id":"e47e828c","type":"photo"},{"richtext":[{"content":[{"text":"کدهای جاوااسکریپت برای توسعه پذیری و درک بهتر برای برنامه نویس و در کل انسان ، بین فایل های مختلف تقسیم میشه. این کار زیاد تاثیری روی performance نداره ولی بهرحال بیانگر ساختاری و سازماندهی کد شماست.","style":{"weight":[]}}]},{"content":[{"text":"توی خیلی زبان های برنامه نویسی گاها شما ممکنه یک جمله ای رو شنیده باشید که گاها میگن ","style":{"weight":[]}},{"text":"فایل bundle","style":{"weight":["BOLD"]}},{"text":" منظور از فایل باندل همین بحث هست که میاد و تمام import ها و export ها توی فایل ها از بین میره و همه چی توی یک فایل جمع میشه.","style":{"weight":[]}}]},{"content":[{"text":"برای جاوااسکریپت ابزاری هست به اسم webpack که میاد و همه ی فایل هایی که شما نوشتی رو توی یک فایل باندل میاره.","style":{"weight":[]}}]}],"id":"106f423d","type":"caption"},{"richtext":[{"content":[{"text":"البته گستره کار با webpack بیشتر از این صحبت هاست ولی توی این سناریو ما میخوایم از webpack برای بستن کد منبع استفاده کنیم","style":{"weight":["ITALIC"]}}]}],"id":"ce924502","type":"frame"},{"richtext":[{"content":[{"text":"کتابخانه ی webpack برای اینکه متوجه بشه که شما ساختار دقیق پروژه شما چطوریه و شما ازش چی میخواید ، یک فایل رو میخونه و براساس اون فایل باندل رو ایجاد میکنه.","style":{"weight":[]}}]},{"content":[{"text":"شما باید روی root پروژه ، ینی همون فولدر اصلی ، یک فایل ایجاد کنید به اسم webpack.config.js که این فایل یک خروجی داره و اون خروجی آپشن هایی هست که webpack اون رو میخونه و اساس بر اون میشه.","style":{"weight":[]}}]}],"id":"b86fabb2","type":"caption"},{"text":"const fs = require(\"fs\");\nconst path = require(\"path\");\n\nconst node_modules = {};\nfs.readdirSync(\"./node_modules\")\n    .filter((name) => {\n        return [\".bin\"].indexOf(name) === -1;\n    })\n    .forEach((name) => {\n        node_modules[name] = `commonjs ${name}`;\n    });\n\nmodule.exports = {\n    entry: \"./index.js\",\n    target: \"node\",\n    output: {\n        path: path.join(__dirname, \"build\"),\n        filename: \"bundle.js\",\n    },\n    externals: node_modules,\n};","id":"9b4c282c","type":"code"},{"richtext":[{"content":[{"text":"کد بالا یک نمونه ساده از یک فایل کانفیگ برای webpack هست. در قسمت module.export که اون نتیجه نهایی برای فایل هست یک سری گزینه ها هست که یکی یکی اونها رو شرح میدم.","style":{"weight":[]}}]},{"content":[{"text":"entry:","style":{"weight":["BOLD"]}},{"text":" همون فایل اصلی رو نشون میده اونی که شروع کننده هست و همه ی import ها از اون شروع میشه...","style":{"weight":[]}}]},{"content":[{"text":"target:","style":{"weight":["BOLD"]}},{"text":" بیانگر اینه که کجا قراره این کد اجرا بشه ینی server side هست یا client side. اگر برای مثال شما بخواید برای react خروجی بگیرید مقدار اون متفاوت میشه.","style":{"weight":[]}}]},{"content":[{"text":"output:","style":{"weight":["BOLD"]}},{"text":" فایل باندل که ایجاد کردید کجا قرار میگیره،آدرس دقیق اون که با استفاده از ماژول path انجام میشه.","style":{"weight":[]}}]},{"content":[{"text":"externals:","style":{"weight":["BOLD"]}},{"text":" دایرکتوری node_module خیلی خیلی عمیق و شلوغ هست. گاها نشون دادن عمق فایل های موجود در اون خیلی زیاد میشه و یه جورایی ضعف نود جی اس هم حساب میشه اما ، اگر شما لازم باشه فایل های این رو هم توی فایل باندل خودتون جا کنید خیلی خیلی فایل بزرگ میشه و بقول معروف anti pattern هست. برای همین فایل باندل بهتره node_module رو توی خودش import کنه و هر فایلی قراره توی باندل import بشه با این گزینه شدنی هست.","style":{"weight":[]}}]},{"content":[{"text":"به استثنا دایرکتوری bin. بقیه تحت عنوان common {name} توی یک کلید مقدار به external اصطلاحا پاس داده میشه.","style":{"weight":[]}}]}],"id":"51d45311","type":"caption"},{"richtext":[{"content":[{"text":"با استفاده از یک دستور ینی npx webpack init میتونید یک فایل webpack ایجاد کنین اما ممکنه بعضی از ساختار فایلهای شما رو تغییر بده برای همین پیشنهاد میکنم خودتون این فایل رو ایجاد کنید که هم به کار مسلط تر بشید هم ساختار حفظ شه","style":{"weight":["ITALIC"]}}]}],"id":"13a15e33","type":"frame"},{"header":"h3","text":"bytenode","id":"1fc89456","type":"title"},{"richtext":[{"content":[{"text":"یکی از کتابخانه هایی که برای node js هست و فایل ها رو به صورت بایت کد در میاره کتابخانه ای به اسم bytenode هست. برای اجرا هم دیگه نمیشه برای اجرا مستقیم این فایل رو به node ارجا داد. برای همین باید از همین کتابخانه استفاده کرد. ضرورت ساختن فایل باندل به اینجا برمیگرده یعنی موقعی که اجرای bytenode حتما باید یک فایل یکپارچه داشت.","style":{"weight":[]}}]}],"id":"979ea5df","type":"caption"},{"richtext":[],"url":"http://localhost:31375/photo/84cc41a6863d8be0c1df4a0b1ee36866.png","id":"cfdb590f","type":"photo"},{"header":"h3","text":"مثال","id":"0472da58","type":"title"},{"richtext":[{"content":[{"text":"حالا تصور میکنیم که فایل کانفیگ webpack رو به ترتیب بالا داریم. باید اول webpack رو نصب کنیم بعد با استفاده از دستور خودش فایل bundle رو بسازیم ، با bytenode از روی فایل باندل یک فایل بایت کد درست کنیم و در آخر هم با همون bytenode فایل باینری رو دانلود کنیم.","style":{"weight":[]}}]}],"id":"3e2b9523","type":"caption"},{"text":"// install webpack\nnpm install webpack webpack-cli\n\n// build bundle with webpack.config.js\nnpx webpack\n\n// install bytenode\nnpm install bytenode\n\n// build bytecodes with bytenode\nnpx bytenode ./build/bundle.js\n\n// run bytecode with bytenode\nnpx bytenode bundle.jsb","id":"c5e6469a","type":"code"},{"richtext":[{"content":[{"text":"bytenode تنها کاری که میکنه باینری کردن یا فقط خواندنی کردن فایل js هست. اصل کار زمانی هست که با webpack کار میکنید. معرفی webpack رو توی نوشته دیگه ای توضیح میدم.","style":{"weight":[]}}]}],"id":"821c9235","type":"caption"}],"author":1,"createAt":"1677786065455","tag":[],"category":{"id":"0ac5ec59adedab83","label":"دنیای node js","admin":1,"description":"نوشته های مربوط به مباحث نود جی اس ، فریم ورک ها ، کتابخانه های آن ","color":"#35862d","avatar":"1e8be93cfe34e4e8372beea9e9544dea.png","_id":"640078191ffd7ad6cb625512","notes":[{"title":"متن بسته nodejs","tag":[],"author":1,"category":"0ac5ec59adedab83","id":"40c76407215f9cb8","createAt":"1677786065455"},{"id":"0859fe9ce0b2c152","title":"nestjs چیست؟","author":1,"createAt":"1677783292284","tag":["nodejs","nestjs","framework ","فریمورک","نود جی اس"],"category":"0ac5ec59adedab83","photo":"d739cee9751e4fc12376bfffbc34486a.jpeg"},{"title":"راهی به اسم nextjs","tag":[],"author":1,"category":"0ac5ec59adedab83","photo":"725e2546ff5b531fe236a801cde8798a.jpeg","id":"5713e88bdcc5a6c2","createAt":"1677785778027"}]}}},"__N_SSG":true}